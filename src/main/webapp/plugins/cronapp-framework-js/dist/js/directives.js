function maskDirectiveAsDate(e,t,n){return maskDirective(e,t,n,"as-date")}function maskDirectiveMask(e,t,n){return maskDirective(e,t,n,"mask")}function maskDirective(e,t,n,a){return{restrict:"A",require:"?ngModel",link:function(e,o,i,r){if("as-date"!=a||void 0===i.mask){var l=n(i.ngModel),s=l.assign,c=$(o);if(!c.data("alreadycompiled")){c.data("alreadycompiled",!0);var d=c.attr("type");if("checkbox"!=d&&"password"!=d){c.data("type",d),c.attr("type","text"),r&&(r.$formatters=[],r.$parsers=[]),void 0!==i.asDate&&"text"==d&&(d="date");var u=!1,p=i.mask||i.format;p=p?parseMaskType(p,t):parseMaskType(d,t),p.endsWith(";0")&&(u=!0);var g=p.replace(";1","").replace(";0","").trim();if(void 0!=g&&0!=g.length)if("date"==d||"datetime"==d||"datetime-local"==d||"month"==d||"time"==d||"time-local"==d||"week"==d){var m={format:g,locale:t.use(),showTodayButton:!0,useStrict:!0,tooltips:{today:t.instant("DatePicker.today"),clear:t.instant("DatePicker.clear"),close:t.instant("DatePicker.close"),selectMonth:t.instant("DatePicker.selectMonth"),prevMonth:t.instant("DatePicker.prevMonth"),nextMonth:t.instant("DatePicker.nextMonth"),selectYear:t.instant("DatePicker.selectYear"),prevYear:t.instant("DatePicker.prevYear"),nextYear:t.instant("DatePicker.nextYear"),selectDecade:t.instant("DatePicker.selectDecade"),prevDecade:t.instant("DatePicker.prevDecade"),nextDecade:t.instant("DatePicker.nextDecade"),prevCentury:t.instant("DatePicker.prevCentury"),nextCentury:t.instant("DatePicker.nextCentury")}};"DD/MM/YYYY"!=g&&"MM/DD/YYYY"!=g&&(m.sideBySide=!0);var f="date"==d||"datetime"==d||"time"==d;if(c.attr("from-grid")){var v=function(){var e=$(this).offset(),t=!0,n=$(this).parent().find(".bootstrap-datetimepicker-widget.dropdown-menu.usetwentyfour.bottom");if(n.length||(t=!1,n=$(this).parent().find(".bootstrap-datetimepicker-widget.dropdown-menu.usetwentyfour.top")),$(n).offset()){var a=$(n).offset().left,o=$("body");n.appendTo(o);var i=0;i=t?e.top+35:e.top-($(n).height()+15),n.css("top",i),n.css("bottom","auto"),n.css("left",a),n.css("z-index",999999)}};if(c.on("click",v),c.on("focus",function(){setTimeout(v.bind(this),100)}),c.on("dp.change",function(){var e=null;e=f?moment.utc(c.val(),g):moment(c.val(),g),c.data("rawvalue",e.toDate())}),c.data("initial-value")){var h=c.data("initial-value"),b=null;b=f?moment.utc(h):moment(h),c.val(b.format(g)),c.data("initial-value",null)}}else c.wrap('<div style="position:relative"></div>');c.datetimepicker(m),c.on("dp.change",function(){$(this).is(":visible")&&($(this).trigger("change"),e.$apply(function(){var t=c.val(),n=null;n=f?moment.utc(t,g):moment(t,g),n.isValid()&&r&&s(e,n.toDate())}))}),r&&(r.$formatters.push(function(e){if(e){var t=null;return t=f?moment.utc(e):moment(e),t.format(g)}return null}),r.$parsers.push(function(e){if(e){if(e instanceof Date)return e;var t=null;return t=f?moment.utc(e,g):moment(e,g),t.toDate()}return null}))}else if("number"==d||"money"==d||"integer"==d){u=!0,!1;var y=g.trim().replace(/\./g,"").replace(/\,/g,"").replace(/#/g,"").replace(/0/g,"").replace(/9/g,""),S="",k="",D="",C=",",M=0;g.startsWith(y)?S=y:g.endsWith(y)&&(k=y);var w=g.trim().replace(S,"").replace(k,"").trim();w.startsWith("#.")?D=".":w.startsWith("#,")&&(D=",");var x=null;if(-1!=w.indexOf(",0")?(C=",",x=",0"):-1!=w.indexOf(".0")&&(C=".",x=".0"),null!=x){var T=w.substring(w.indexOf(x)+1);M=T.length}var F="numeric";0==M&&(F="integer");var I={rightAlign:"money"==d,unmaskAsNumber:!0,allowMinus:!0,prefix:S,suffix:k,radixPoint:C,digits:M};D&&(I.autoGroup=!0,I.groupSeparator=D),$(o).inputmask(F,I);var E=function(){$(this).data("rawvalue",$(this).inputmask("unmaskedvalue"))};$(o).on("keydown",E).on("keyup",E),r&&(r.$formatters.push(function(e){return void 0!=e&&null!=e&&""!=e?format(g,e):null}),r.$parsers.push(function(e){if(void 0!=e&&null!=e&&""!=e){var t=c.inputmask("unmaskedvalue");if(""!=t)return t}return null}))}else if("text"==d||"tel"==d){var m={};i.maskPlaceholder&&(m.placeholder=i.maskPlaceholder),c.mask(g,m);var E=function(){u&&$(this).data("rawvalue",$(this).cleanVal())};$(o).on("keydown",E).on("keyup",E),u&&r&&(r.$formatters.push(function(e){return e?c.masked(e):null}),r.$parsers.push(function(e){return e?c.cleanVal():null}))}else if(c.attr("from-grid")){var E=function(){$(this).data("rawvalue",$(this).val())};$(o).on("keydown",E).on("keyup",E)}}}}}}}function parseMaskType(e,t){return"datetime"==e||"datetime-local"==e?"Format.DateTime"==(e=t.instant("Format.DateTime"))&&(e="DD/MM/YYYY HH:mm:ss"):"date"==e?"Format.Date"==(e=t.instant("Format.Date"))&&(e="DD/MM/YYYY"):"time"==e||"time-local"==e?"Format.Hour"==(e=t.instant("Format.Hour"))&&(e="HH:mm:ss"):"month"==e?e="MMMM":"number"==e?"Format.Decimal"==(e=t.instant("Format.Decimal"))&&(e="0,00"):"money"==e?"Format.Money"==(e=t.instant("Format.Money"))&&(e="#.#00,00"):"integer"==e?e="0":"week"==e?e="dddd":"tel"==e?e="(00) 00000-0000;0":"text"==e&&(e=""),e}maskDirectiveAsDate.$inject=["$compile","$translate","$parse"],maskDirectiveMask.$inject=["$compile","$translate","$parse"],function($app){app.common={generateId:function(){var e=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return"0123456789".indexOf(e.substr(0,1))>-1?this.generateId():e}};var isoDate=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,ISO_PATTERN=new RegExp("(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d\\.\\d+([+-][0-2]\\d:[0-5]\\d|Z))|(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d([+-][0-2]\\d:[0-5]\\d|Z))|(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d([+-][0-2]\\d:[0-5]\\d|Z))"),patternFormat=function(e){return e?$(e).attr("format")||"DD/MM/YYYY":"DD/MM/YYYY"},parsePermission=function(e){var t={visible:{public:!0},enabled:{public:!0}};if(e)for(var n=e.toLowerCase().trim().split(","),a=0;a<n.length;a++){var o=n[a].trim();if(o){var i=o.split(":");if(2==i.length){var r=i[0].trim(),l=i[1].trim();if(l){for(var s=l.split(";"),c={},d=0;d<s.length;d++){var u=s[d].trim();u&&(c[u]=!0)}t[r]=c}}}}return t};app.directive("asDate",maskDirectiveAsDate).directive("ngDestroy",function(){return{restrict:"A",link:function(scope,element,attrs,ctrl){element.on("$destroy",function(){attrs.ngDestroy&&attrs.ngDestroy.length>0&&(attrs.ngDestroy.indexOf("app.")>-1||attrs.ngDestroy.indexOf("blockly.")>-1?scope.$eval(attrs.ngDestroy):eval(attrs.ngDestroy))})}}}).directive("dynamicImage",["$compile",function(e){return{restrict:"E",replace:!0,scope:{ngModel:"@",width:"@",height:"@",style:"@",class:"@"},require:"ngModel",template:"<div></div>",init:function(e){e.ngModel||(e.ngModel=""),e.width||(e.width="128"),e.height||(e.height="128"),e.style||(e.style=""),e.class||(e.class=""),this.containsLetter(e.width)||(e.width+="px"),this.containsLetter(e.height)||(e.height+="px")},containsLetter:function(e){for(var t,n=0;n<e.length;n++){t=!0;for(var a=0;a<10;a++)parseInt(e[n])==a&&(t=!1);if(t)break}return t},link:function(t,n,a){this.init(t);var o=t,i=a.ngRequired&&"true"==a.ngRequired?"required":"";n.append('<div class="form-group upload-image-component" ngf-drop="" ngf-drag-over-class="dragover">                                  <img class="$class$" style="$style$; height: $height$; width: $width$;" ng-if="$ngModel$" data-ng-src="{{$ngModel$.startsWith(\'http\') || ($ngModel$.startsWith(\'/\') && $ngModel$.length < 1000)? $ngModel$ : \'data:image/png;base64,\' + $ngModel$}}">                                  <img class="$class$" style="$style$; height: $height$; width: $width$;" ng-if="!$ngModel$" data-ng-src="/plugins/cronapp-framework-js/img/selectImg.svg" class="btn" ng-if="!$ngModel$" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.setFile(\'$ngModel$\', $file)" accept="image/*;capture=camera">                                  <div class="remove btn btn-danger btn-xs" ng-if="$ngModel$" ng-click="$ngModel$=null">                                    <span class="glyphicon glyphicon-remove"></span>                                  </div>                                  <div class="btn btn-info btn-xs start-camera-button" ng-if="!$ngModel$" ng-click="cronapi.internal.startCamera(\'$ngModel$\')">                                    <span class="glyphicon glyphicon-facetime-video"></span>                                  </div>                                  <input ng-if="!$ngModel$" autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="top: inherit !important; margin-left: 85px !important;margin-top: 50px !important;" type=text ng-model="$ngModel$" $required$>                                </div>'.split("$height$").join(o.height).split("$width$").join(o.width).split("$ngModel$").join(o.ngModel).split("$style$").join(o.style).split("$class$").join(o.class).split("$required$").join(i)),e(n)(n.scope())}}}]).directive("dynamicImage",["$compile",function(e){return{restrict:"A",scope:!0,require:"ngModel",link:function(t,n,a){var o=a.ngRequired&&"true"==a.ngRequired?"required":"",i=n.html(),r='<div ngf-drop="" ngf-drag-over-class="dragover">           <img style="width: 100%;" ng-if="$ngModel$" data-ng-src="{{$ngModel$.startsWith(\'http\') || ($ngModel$.startsWith(\'/\') && $ngModel$.length < 1000)? $ngModel$ : \'data:image/png;base64,\' + $ngModel$}}">           <input ng-if="!$ngModel$" autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="top: inherit !important; margin-left: 85px !important;margin-top: 50px !important;" type=text ng-model="$ngModel$" $required$>           <div class="btn" ng-if="!$ngModel$" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.setFile(\'$ngModel$\', $file)" ngf-pattern="\'image/*\'" ngf-max-size="$maxFileSize$">             $userHtml$           </div>           <div class="remove-image-button btn btn-danger btn-xs" ng-if="$ngModel$" ng-click="$ngModel$=null">             <span class="glyphicon glyphicon-remove"></span>           </div>           <div class="btn btn-info btn-xs start-camera-button-attribute" ng-if="!$ngModel$" ng-click="cronapi.internal.startCamera(\'$ngModel$\')">             <span class="glyphicon glyphicon-facetime-video"></span>           </div>         </div>',l="";a.maxFileSize&&(l=a.maxFileSize),r=$(r.split("$ngModel$").join(a.ngModel).split("$required$").join(o).split("$userHtml$").join(i).split("$maxFileSize$").join(l)),n.html(r),e(r)(n.scope())}}}]).directive("dynamicFile",["$compile",function(e){return{restrict:"A",scope:!0,require:"ngModel",link:function(t,n,a){var o=a.ngRequired&&"true"==a.ngRequired?"required":"",i=a.ngModel.split("."),r=i[0],l=i[i.length-1],s=Math.floor(1e3*Math.random()+20),c=n.html(),d="";a.maxFileSize&&(d=a.maxFileSize);var u='                                <div ng-show="!$ngModel$" ngf-drop="" ngf-drag-over-class="dragover">                                  <input ng-if="!$ngModel$" autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="top: inherit !important;margin-left: 85px !important;margin-top: 50px !important;" type=text ng-model="$ngModel$" $required$>                                  <div class="btn" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.uploadFile(\'$ngModel$\', $file, \'uploadprogress$number$\')" ngf-max-size="$maxFileSize$">                                    $userHtml$                                  </div>                                  <div class="progress" data-type="bootstrapProgress" id="uploadprogress$number$" style="display:none">                                    <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:0%">                                      <span class="sr-only"></span>                                    </div>                                  </div>                                </div>                                 <div ng-show="$ngModel$" class="upload-image-component-attribute">                                   <div class="btn btn-danger btn-xs ng-scope" style="float:right;" ng-if="$ngModel$" ng-click="$ngModel$=null">                                     <span class="glyphicon glyphicon-remove"></span>                                   </div>                                   <div>                                     <div ng-bind-html="cronapi.internal.generatePreviewDescriptionByte($ngModel$)"></div>                                     <a href="javascript:void(0)" ng-click="cronapi.internal.downloadFileEntity($datasource$,\'$field$\')">download</a>                                   </div>                                 </div>                                 ';u=$(u.split("$ngModel$").join(a.ngModel).split("$datasource$").join(r).split("$field$").join(l).split("$number$").join(s).split("$required$").join(o).split("$userHtml$").join(c).split("$maxFileSize$").join(d)),n.html(u),e(u)(n.scope())}}}]).directive("dynamicFile",["$compile",function(e){return{restrict:"E",replace:!0,scope:{ngModel:"@"},require:"ngModel",template:"<div></div>",init:function(e){e.ngModel||(e.ngModel="")},link:function(t,n,a){this.init(t);var o=t,i=a.ngRequired&&"true"==a.ngRequired?"required":"",r=o.ngModel.split("."),l=r[0],s=r[r.length-1],c=Math.floor(1e3*Math.random()+20);n.append('                                <div ng-show="!$ngModel$">                                  <input ng-if="!$ngModel$" autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="top: inherit !important;margin-left: 85px !important;margin-top: 50px !important;" type=text ng-model="$ngModel$" $required$>                                  <div class="form-group upload-image-component" ngf-drop="" ngf-drag-over-class="dragover">                                     <img class="ng-scope" style="height: 128px; width: 128px;" ng-if="!$ngModel$" data-ng-src="/plugins/cronapp-framework-js/img/selectFile.png" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.uploadFile(\'$ngModel$\', $file, \'uploadprogress$number$\')" accept="*">                                    <progress id="uploadprogress$number$" max="100" value="0" style="position: absolute; width: 128px; margin-top: -134px;">0</progress>                                  </div>                                </div>                                 <div ng-show="$ngModel$" class="form-group upload-image-component">                                   <div class="btn btn-danger btn-xs ng-scope" style="float:right;" ng-if="$ngModel$" ng-click="$ngModel$=null">                                     <span class="glyphicon glyphicon-remove"></span>                                   </div>                                   <div>                                     <div ng-bind-html="cronapi.internal.generatePreviewDescriptionByte($ngModel$)"></div>                                     <a href="javascript:void(0)" ng-click="cronapi.internal.downloadFileEntity($datasource$,\'$field$\')">download</a>                                   </div>                                 </div>                                 '.split("$ngModel$").join(o.ngModel).split("$datasource$").join(l).split("$field$").join(s).split("$number$").join(c).split("$required$").join(i)),e(n)(n.scope())}}}]).directive("pwCheck",[function(){"use strict";return{require:"ngModel",link:function(e,t,n,a){var o="#"+n.pwCheck;t.add(o).on("keyup",function(){e.$apply(function(){var e=t.val()===$(o).val();a.$setValidity("pwmatch",e)})})}}}]).directive("ngClick",[function(){"use strict";return{link:function(scope,elem,attrs,ctrl){if(scope.rowData){var crnDatasource=elem.closest("[crn-datasource]");crnDatasource.length>0&&elem.on("click",function(){scope.$apply(function(){var datasource=eval(crnDatasource.attr("crn-datasource"));datasource.active=scope.rowData})})}}}}]).directive("valid",function(){return{require:"^ngModel",restrict:"A",link:function(e,t,n,a){var o={cpf:CPF,cnpj:CNPJ};a.$validators[n.valid]=function(e,a){var i=e||a,r=o[n.valid].isValid(i);return r?t[0].setCustomValidity(""):t.scope().$applyAsync(function(){t[0].setCustomValidity(t[0].dataset.errorMessage)}),r||!i}}}}).directive("cronappSecurity",function(){return{restrict:"A",link:function(e,t,n){var a=[];e.session&&e.session.roles&&(a=e.session.roles.toLowerCase().split(","));for(var o=parsePermission(n.cronappSecurity),i=!1,r=!1,l=0;l<a.length;l++){var s=a[l].trim();s&&(o.visible[s]&&(i=!0),o.enabled[s]&&(r=!0))}i||$(t).hide(),r||$(t).find("*").addBack().attr("disabled",!0)}}}).directive("qr",["$window",function(e){return{restrict:"A",require:"^ngModel",template:'<canvas ng-hide="image"></canvas><img ng-if="image" ng-src="{{canvasImage}}"/>',link:function(t,n,a,o){void 0===t.size&&a.size&&(t.text=a.size);var i=function(){return o.$modelValue||""},r=function(e){return/^[0-9]*$/.test(e)},l=function(e){return/^[0-9A-Z $%*+\-.\/:]*$/.test(e)},s=function(e){for(var t=0;t<e.length;t++){if(e.charCodeAt(t)>255)return!1}return!0},c=function(e,t){if("NUMBER"===e&&!r(t))throw new Error("The `NUMBER` input mode is invalid for text.");if("ALPHA_NUM"===e&&!l(t))throw new Error("The `ALPHA_NUM` input mode is invalid for text.");if("8bit"===e&&!s(t))throw new Error("The `8bit` input mode is invalid for text.");if(!s(t))throw new Error("Input mode is invalid for text.");return!0},d=function(e){var n=t.inputMode;return n=n||(r(e)?"NUMBER":void 0),n=n||(l(e)?"ALPHA_NUM":void 0),n=n||(s(e)?"8bit":""),c(n,e)?n:""},u=n.find("canvas")[0],p=!!e.CanvasRenderingContext2D;t.TYPE_NUMBER=function(){return t.typeNumber||0}(),t.TEXT=i(),t.CORRECTION=function(){return{L:1,M:0,Q:3,H:2}[t.correctionLevel||0]||0}(),t.SIZE=function(){return t.size||$(n).outerWidth()}(),t.INPUT_MODE=d(t.TEXT),t.canvasImage="";var g=function(e,t,n,a){for(var o=0;o<n;o++)for(var i=0;i<n;i++){var r=Math.ceil((i+1)*a)-Math.floor(i*a),l=Math.ceil((o+1)*a)-Math.floor(o*a);e.fillStyle=t.isDark(o,i)?"#000":"#fff",e.fillRect(Math.round(i*a),Math.round(o*a),r,l)}},m=function(e,n,a,o,i,r){var l=/^\s+|\s+$/g,s=n.replace(l,""),c=new QRCode(a,o,r);c.addData(s),c.make();var d=e.getContext("2d"),u=c.getModuleCount(),m=i/u;e.width=e.height=i,p&&(g(d,c,u,m),t.canvasImage=e.toDataURL()||"")};t.$watch(function(){return o.$modelValue},function(e,n){e!==n&&(t.text=o.$modelValue,t.TEXT=i(),t.INPUT_MODE=d(t.TEXT),m(u,t.TEXT,t.TYPE_NUMBER,t.CORRECTION,t.SIZE,t.INPUT_MODE))}),m(u,t.TEXT,t.TYPE_NUMBER,t.CORRECTION,t.SIZE,t.INPUT_MODE)}}}]).directive("uiSelect",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(t,n,a,o){if(void 0!=a.required||"true"===a.ngRequired){$(n).append('<input autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="left: 50%!important; top: 100%!important;" type=text ng-model="'+a.ngModel+'" required>');var i=$(n).find("input.uiSelectRequired");e(i)(n.scope())}}}}]).filter("raw",["$translate",function(e){return function(e){return null!=e&&void 0!==e?"number"==typeof e?e+"":"boolean"==typeof e?e+"":e instanceof Date?"datetimeoffset'"+e.toISOString()+"'":e.length>=10&&e.match(ISO_PATTERN)?"datetimeoffset'"+e+"'":"'"+e+"'":""}}]).filter("mask",["$translate",function(e){return function(t,n){if(!(n=parseMaskType(n,e)))return t;if(n=n.replace(";1","").replace(";0","").trim(),"string"==typeof t&&t.match(isoDate))return moment.utc(t).format(n);if(t instanceof Date)return moment.utc(t).format(n);if("number"==typeof t)return format(n,t);if(void 0!=t&&null!=t&&""!=t){var a=$('<input type="text">');return a.mask(n),a.masked(t)}return t}}]).directive("mask",maskDirectiveMask).directive("cronappFilter",["$compile",function($compile){return{restrict:"A",require:"?ngModel",setFilterInButton:function(e,t,n){var a=e.closest("fieldset");if(a){var o=a.find("button[cronapp-filter]");if(o){var i=o.data("filters");i||(i=[]);var r=-1,l=e.attr("ng-model");if($(i).each(function(e){this.ngModel==l&&(r=e)}),r>-1&&i.splice(r,1),t.length>0){var s={ngModel:l,bindedFilter:t};i.push(s)}o.data("filters",i)}}},makeAutoPostSearch:function(e,t,n,a){var o=e.closest("fieldset");if(o&&o.length>0){var i=o.find("button[cronapp-filter]");if(i&&i.length>0){var r=i.data("filters");r&&r.length>0&&(t="",$(r).each(function(){t+=this.bindedFilter+";"}))}}n.search(t,"true"==a.cronappFilterCaseinsensitive)},inputBehavior:function(scope,element,attrs,ngModelCtrl,$element,typeElement,operator,autopost){var filterTemplate="",filtersSplited=attrs.cronappFilter.split(";"),datasource;if(attrs.crnDatasource)datasource=eval(attrs.crnDatasource);else{var fieldset=$element.closest("fieldset");if(!fieldset)return;var button=fieldset.find("button[cronapp-filter]");if(!button)return;if(!button.attr("crn-datasource"))return;datasource=eval(button.attr("crn-datasource"))}var isOData=datasource.isOData();$(filtersSplited).each(function(){this.length>0&&(""!=filterTemplate&&(filterTemplate+=isOData?" or ":";"),isOData?"="==operator&&"text"==typeElement?filterTemplate+="substringof({value.lower}, tolower("+this+"))":"="==operator?filterTemplate+=this+" eq {value}":"!="==operator?filterTemplate+=this+" ne {value}":">"==operator?filterTemplate+=this+" gt {value}":">="==operator?filterTemplate+=this+" ge {value}":"<"==operator?filterTemplate+=this+" lt {value}":"<="==operator&&(filterTemplate+=this+" le {value}"):filterTemplate+="text"==typeElement?this+"@"+operator+"%{value}%":this+operator+"{value}")}),0==filterTemplate.length&&(filterTemplate=isOData?"{value}":"%{value}%");var selfDirective=this;ngModelCtrl?scope.$watch(attrs.ngModel,function(e,t){if(!angular.equals(e,t)){var n=$element.data("type")||$element.attr("type"),a=ngModelCtrl.$modelValue;isOData?a instanceof Date?a="datetime-local"==n?"datetimeoffset'"+a.toISOString()+"'":"datetime'"+a.toISOString().substring(0,23)+"'":"number"==typeof a?a+="M":a="boolean"==typeof a?a:"'"+a+"'":a instanceof Date?(a=a.toISOString(),a+="date"==n?"@@date":"time"==n||"time-local"==n?"@@time":"@@datetime"):"number"==typeof a?a+="@@number":"boolean"==typeof a&&(a+="@@boolean");var o=filterTemplate.split("{value}").join(a);o="string"==typeof a?o.split("{value.lower}").join(a.toLowerCase()):o.split("{value.lower}").join(a),0==ngModelCtrl.$viewValue.length&&(o=""),selfDirective.setFilterInButton($element,o,operator),autopost&&selfDirective.makeAutoPostSearch($element,o,datasource,attrs)}}):"text"==typeElement?$element.on("keyup",function(){var datasource=eval(attrs.crnDatasource),value=void 0;value=ngModelCtrl&&void 0!=ngModelCtrl?ngModelCtrl.$viewValue:this.value;var bindedFilter=filterTemplate.split("{value}").join(value);0==this.value.length&&(bindedFilter=""),selfDirective.setFilterInButton($element,bindedFilter,operator),autopost&&selfDirective.makeAutoPostSearch($element,bindedFilter,datasource,attrs)}):$element.on("change",function(){var datasource=eval(attrs.crnDatasource),value=void 0,typeElement=$(this).attr("type");if(void 0!=attrs.asDate&&(typeElement="date"),ngModelCtrl&&void 0!=ngModelCtrl)value=ngModelCtrl.$viewValue;else if("checkbox"==typeElement)value=$(this).is(":checked");else if("date"==typeElement){if(value=this.value,this.value.length>0){var momentDate=moment(this.value,patternFormat(this));value=momentDate.toDate().toISOString()}}else value=this.value;var bindedFilter=filterTemplate.split("{value}").join(value);0==value.toString().length&&(bindedFilter=""),selfDirective.setFilterInButton($element,bindedFilter,operator),autopost&&selfDirective.makeAutoPostSearch($element,bindedFilter,datasource,attrs)})},forceDisableDatasource:function(datasourceName,scope){var disableDatasource=setInterval(function(){try{var datasourceInstance=eval(datasourceName);datasourceInstance&&($(document).ready(function(){var e=0,t=setInterval(function(){e<10?(scope.$apply(function(){datasourceInstance.enabled=!1,datasourceInstance.data=[]}),e++):clearInterval(t)},20)}),clearInterval(disableDatasource))}catch(e){}},10)},buttonBehavior:function(scope,element,attrs,ngModelCtrl,$element,typeElement,operator,autopost){var datasourceName="";datasourceName=attrs.crnDatasource?attrs.crnDatasource:$element.parent().attr("crn-datasource");var datasource=eval(datasourceName),isOData=datasource.isOData(),requiredFilter=attrs.requiredFilter&&"true"==attrs.requiredFilter.toString();requiredFilter&&this.forceDisableDatasource(datasourceName,scope),$element.on("click",function(){var $this=$(this),filters=$this.data("filters");if(datasourceName&&datasourceName.length>0&&filters){var bindedFilter="";$(filters).each(function(){""!=bindedFilter&&(bindedFilter+=isOData?" and ":";"),bindedFilter+=this.bindedFilter});var datasourceToFilter=eval(datasourceName);requiredFilter?(datasourceToFilter.enabled=bindedFilter.length>0,datasourceToFilter.enabled?datasourceToFilter.search(bindedFilter,"true"==attrs.cronappFilterCaseinsensitive):scope.$apply(function(){datasourceToFilter.data=[]})):datasourceToFilter.search(bindedFilter,"true"==attrs.cronappFilterCaseinsensitive)}})},link:function(e,t,n,a){var o=$(t),i=o.data("type")||o.attr("type");void 0!=n.asDate&&(i="date");var r="=";n.cronappFilterOperator&&n.cronappFilterOperator.length>0&&(r=n.cronappFilterOperator);var l=!0;n.cronappFilterAutopost&&"false"==n.cronappFilterAutopost&&(l=!1),setTimeout(function(){"INPUT"==o[0].tagName?this.inputBehavior(e,t,n,a,o,i,r,l):this.buttonBehavior(e,t,n,a,o,i,r,l)}.bind(this),100)}}}]).directive("cronRichEditor",["$compile",function(e){return{restrict:"E",replace:!0,require:"ngModel",parseToTinyMCEOptions:function(e){var t={};t.allowFullScreen="fullscreen |",t.allowPage="fullpage newdocument code pagebreak |",t.allowPrint="preview print |",t.allowTransferArea="cut copy paste |",t.allowDoUndo="undo redo |",t.allowSymbol="charmap |",t.allowEmbeddedImage="bdesk_photo |",t.allowFont="formatselect fontselect fontsizeselect strikethrough bold italic underline removeformat |",t.allowLinks="link unlink anchor |",t.allowParagraph="alignleft aligncenter alignright alignjustify numlist bullist outdent indent blockquote hr |",t.allowFormulas="tiny_mce_wiris_formulaEditor tiny_mce_wiris_formulaEditorChemistry tiny_mce_wiris_CAS |";var n={menubar:!1,statusbar:!1,plugins:"bdesk_photo advlist anchor autolink autoresize autosave charmap code colorpicker contextmenu directionality emoticons fullpage fullscreen hr image imagetools importcss insertdatetime legacyoutput link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace tabfocus table template toc visualblocks visualchars wordcount tiny_mce_wiris",toolbar:"",content_style:""};for(var a in e)a.startsWith("allow")&&e[a]&&(n.toolbar+=" "+t[a]);return n.menubar=e.showMenuBar,n.statusbar=e.showStatusBar,n.content_style=e.contentStyle,JSON.stringify(n)},link:function(t,n,a,o){var i=JSON.parse(a.options),r=this.parseToTinyMCEOptions(i),l='                  <textarea                     ui-tinymce="$options$"                     ng-model="$ngModel$"                     id="$id$"                     ng-click="$ngClick$"                     ng-dblclick="$ngDblclick$"                     ng-mousedown="$ngMouseDown$"                     ng-mouseup="$ngMouseUp$"                     ng-mousemove="$ngMouseMove$"                     ng-mouseover="$ngMouseOver$"                     ng-mouseenter="$ngMouseEnter$"                     ng-mouseleave="$ngMouseLeave$"                     ng-keydown="$ngKeydown$"                     ng-keyup="$ngKeyup$"                     ng-keypress="$ngKeypress$"                    ng-context-menu="$ngContextMenu$"                     ng-paste="$ngPaste$"                     ng-init="$ngInit$"                     ng-focus="$ngFocus$"                     ng-blur="$ngBlur$"                     ng-before-set-content="$ngBeforeSetContent$"                     ng-set-content="$ngSetContent$"                     ng-get-content="$ngGetContent$"                     ng-pre-process="$ngPreProcess$"                     ng-post-process"$ngPostProcess$"                     ng-node-change="$ngNodeChange$"                     ng-undo="$ngUndo$"                     ng-redo="$ngRedo$"                     ng-change="$ngChange$"                     ng-dirty="$ngDirty$"                     ng-remove="$ngRemove$"                     ng-exec-command="$ngExecCommand$"                     ng-paste-pre-process="$ngPastePreProcess$"                     ng-paste-post-process="$ngPastePostProcess$"                     ng-add-editor="$ngAddEditor$"                     ng-remove-editor="$ngRemoveEditor$"                   </textarea>                 ';l=$(l.split("$ngModel$").join(a.ngModel).split("$ngClick$").join(a.ngClick||"").split("$ngDblclick$").join(a.ngDblclick||"").split("$ngMouseDown$").join(a.ngMouseDown||"").split("$ngMouseUp$").join(a.ngMouseUp||"").split("$ngMouseMove$").join(a.ngMouseMove||"").split("$ngMouseOver$").join(a.ngMouseOver||"").split("$ngMouseEnter$").join(a.ngMouseEnter||"").split("$ngMouseLeave$").join(a.ngMouseLeave||"").split("$ngKeydown$").join(a.ngKeydown||"").split("$ngKeyup$").join(a.ngKeyup||"").split("$ngKeypress$").join(a.ngKeypress||"").split("$ngContextMenu$").join(a.ngContextMenu||"").split("$ngPaste$").join(a.ngPaste||"").split("$ngInit$").join(a.ngInit||"").split("$ngFocus$").join(a.ngFocus||"").split("$ngBlur$").join(a.ngBlur||"").split("$ngBeforeSetContent$").join(a.ngBeforeSetContent||"").split("$ngSetContent$").join(a.ngSetContent||"").split("$ngGetContent$").join(a.ngGetContent||"").split("$ngPreProcess$").join(a.ngPreProcess||"").split("$ngPostProcess$").join(a.ngPostProcess||"").split("$ngNodeChange$").join(a.ngNodeChange||"").split("$ngUndo$").join(a.ngUndo||"").split("$ngRedo$").join(a.ngRedo||"").split("$ngChange$").join(a.ngChange||"").split("$ngDirty$").join(a.ngDirty||"").split("$ngRemove$").join(a.ngRemove||"").split("$ngExecCommand$").join(a.ngExecCommand||"").split("$ngPastePreProcess$").join(a.ngPastePreProcess||"").split("$ngPastePostProcess$").join(a.ngPastePostProcess||"").split("$ngAddEditor$").join(a.ngAddEditor||"").split("$ngRemoveEditor$").join(a.ngRemoveEditor||"").split("$id$").join(a.id||app.common.generateId()).split("$options$").join(escape(r)));var s=angular.element(l);n.html(""),n.append(s),n.attr("id",null),e(s)(t)}}}]).directive("cronGrid",["$compile","$translate",function($compile,$translate){return{restrict:"E",replace:!0,require:"ngModel",initCulture:function(){var e=$translate.use();e=e.replace(/_/gm,"-");var t=e.split("-");t[t.length-1]=t[t.length-1].toUpperCase(),e=t.join("-"),kendo.culture(e)},generateBlocklyCall:function(e){var t;if("client"==e.type){t="cronapi.client('"+e.blocklyClass+"."+e.blocklyMethod+"')";var n="";e.blocklyParams.forEach(function(e){n.length>0&&(n+=", "),n+=e.value?e.value:"null"}),t+=".run("+n+")"}else if("server"==e.type){var a=e.blocklyClass+"."+e.blocklyMethod;t="cronapi.server('"+a+"')";var n="";e.blocklyParams.forEach(function(e){n.length>0&&(n+=", "),n+=e.value?e.value:"null"}),t+=".run("+n+")"}return t},generateToolbarButtonCall:function(toolbarButton,scope,options){var buttonCall,generateObjTemplate=function(e,t,n){return{template:function(){var a=app.common.generateId();return createTemplateButton(a,e,t,n)}.bind(this)}}.bind(this),createTemplateButton=function(buttonId,functionToCall,title,iconClass){var template=""
;"SaveOrCancelChanges"==toolbarButton.type?template=toolbarButton.saveButton?'<a role="button" class="saveorcancelchanges k-button k-button-icontext k-grid-save-changes" id="#BUTTONID#" href="javascript:void(0)"><span class="k-icon k-i-check"></span>#TITLE#</a>':'<a role="button" class="saveorcancelchanges k-button k-button-icontext k-grid-cancel-changes" id="#BUTTONID#" href="javascript:void(0)"><span class="k-icon k-i-cancel" ></span>#TITLE#</a>':"Blockly"==toolbarButton.type||"Customized"==toolbarButton.type?template='<a class="k-button k-grid-custom" id="#BUTTONID#" href="javascript:void(0)"><span class="#ICONCLASS#" ></span>#TITLE#</a>':"Native"==toolbarButton.type&&"create"==toolbarButton.title&&(template='<a role="button" id="#BUTTONID#" class="k-button k-button-icontext k-grid-add" href="javascript:void(0)"><span class="k-icon k-i-plus"></span>{{"Add" | translate}}</a>'),template=template.split("#BUTTONID#").join(buttonId).split("#FUNCTIONCALL#").join(this.encodeHTML(functionToCall)).split("#TITLE#").join(title).split("#ICONCLASS#").join(iconClass);var cronappDatasource=eval(options.dataSourceScreen.entityDataSource.name),waitRender=setInterval(function(){$("#"+buttonId).length>0&&(scope.safeApply(function(){var e=angular.element($("#"+buttonId));$compile(e)(scope)}),$("#"+buttonId).click(function(){var e={item:cronappDatasource.active,index:cronappDatasource.cursor},t={currentData:cronappDatasource.data,datasource:cronappDatasource,selectedIndex:cronappDatasource.cursor,index:cronappDatasource.cursor,selectedRow:cronappDatasource.active,consolidated:e,item:cronappDatasource.active,selectedKeys:cronappDatasource.getKeyValues(cronappDatasource.active,!0)};scope.$eval(functionToCall,t)}.bind(this)),clearInterval(waitRender))}.bind(this),200);return template}.bind(this),call="";call="Customized"==toolbarButton.type?toolbarButton.execute:toolbarButton.methodCall?toolbarButton.methodCall:this.generateBlocklyCall(toolbarButton.blocklyInfo);var title=void 0==toolbarButton.title?"":toolbarButton.title;return buttonCall=generateObjTemplate(call,title,toolbarButton.iconClass)},generateModalSaveOrCancelButtonCall:function(e,t,n,a,o){var i=app.common.generateId();return buttonCall=function(e,t,n,a){var r;r="save"==e?'<button id="#BUTTONID#" class="btn btn-primary btn-fab ng-binding grid-save-button-modal k-button" data-component="crn-button" ng-click="#FUNCTIONCALL#" onclick="(!#DATASOURCENAME#.missingRequiredField()?$(\'##MODALID#\').modal(\'hide\'):void(0))"><span class="k-icon k-i-check"></span></button>':'<button id="#BUTTONID#" type="button" class="btn btn-default btn-fab ng-binding k-button" data-component="crn-button" data-dismiss="modal"><span class="k-icon k-i-cancel"></span></button>',r=r.split("#BUTTONID#").join(i).split("#FUNCTIONCALL#").join(t).split("#DATASOURCENAME#").join(n).split("#MODALID#").join(a);var l=setInterval(function(){$("#"+i).length>0&&o.safeApply(function(){var e=angular.element($("#"+i));$compile(e)(o),clearInterval(l)})},200);return r}(e,t,n,a),buttonCall},addButtonsInModal:function(e,t,n){var a=$("#"+e).find(".modal-footer");if(!a.find(".grid-save-button-modal").length){var o=t+".post();",i=this.generateModalSaveOrCancelButtonCall("save",o,t,e,n);a.append(i);var r=this.generateModalSaveOrCancelButtonCall("cancel",null,null,null,n);a.append(r)}},getObjectId:function(e){if(e){if(e instanceof Date){var t=moment.utc(e);e=new Date(t.format("YYYY-MM-DDTHH:mm:ss"))}else if("object"==typeof e)if(e.id)e=e.id;else for(var n in e){e=e[n];break}}else e="";return e},encodeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},decodeHTML:function(e){return e.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},getColumns:function(e,t,n){function a(e){var t="#=showTreatedValue("+e.field+")#";return"switch"==e.inputType?t='<span class="k-switch km-switch k-widget km-widget k-switch-off km-switch-off" style="width: 100%">                  <span class="k-switch-wrapper km-switch-wrapper">                    <span class="k-switch-background km-switch-background" style="margin-left: #='+e.field+' ? "80%": "0%" #"></span>                  </span>                  <span class="k-switch-container km-switch-container">                    <span class="k-switch-handle km-switch-handle" style=#='+e.field+' ? "float:right;margin-right:-1px": "margin-left:0%" #>                    </span>                  </span>                </span>':"checkbox"==e.inputType||"boolean"==e.type?t="<input type='checkbox' class='k-checkbox' #="+e.field+" ? \"checked='checked'\": '' # /><label class='k-checkbox-label k-no-text'></label>":e.displayField&&e.displayField.length>0?t=e.type.startsWith("date")||e.type.startsWith("month")||e.type.startsWith("time")||e.type.startsWith("week")||e.type.startsWith("money")||e.type.startsWith("number")||e.type.startsWith("tel")||e.format&&"null"!=e.format?"#= useMask("+e.displayField+",'"+e.format+"','"+e.type+"') #":"#="+e.displayField+"#":(e.type.startsWith("date")||e.type.startsWith("month")||e.type.startsWith("time")||e.type.startsWith("week")||e.type.startsWith("money")||e.type.startsWith("number")||e.type.startsWith("tel")||e.format&&"null"!=e.format)&&(t="#= useMask("+e.field+",'"+e.format+"','"+e.type+"') #"),t}function o(e){if(!(e.type.startsWith("date")||e.type.startsWith("month")||e.type.startsWith("time")||e.type.startsWith("week")||e.type.startsWith("money")||e.type.startsWith("number")||e.type.startsWith("tel")))return e.format}function i(t){var n=null;return e.columns.forEach(function(e){e.field==t&&(n=e)}),n}function r(e){var n=!1,a=null;return t.schema.model.fields[e]&&(a=t.schema.model.fields[e]),a&&(n=!a.nullable),n}function l(e){return s.bind(this)}function s(e,t){var a=i(t.field);void 0==a.visibleCrud||a.visibleCrud||(e.parent().find(".k-edit-label [for="+a.field+"]").parent().remove(),e.remove());var o=r(t.field)?"required":"",l=app.common.generateId(),s=$("<input "+o+' name="'+t.field+'" id="'+l+'"from-grid=true />');if("dynamicComboBox"==a.inputType||"comboBox"==a.inputType){var c=app.kendoHelper.getConfigCombobox(a.comboboxOptions,n);c.autoBind=!0,c.optionLabel=void 0,a.displayField&&(c.change=function(e){t.model.set(a.displayField,this.text()),t.model.dirty=!0,t.model.dirtyFields[a.displayField]=!0}),s.appendTo(e).kendoDropDownList(c,n)}else if("slider"==a.inputType){var c=app.kendoHelper.getConfigSlider(a.sliderOptions);s.appendTo(e).kendoSlider(c,n)}else if("switch"==a.inputType){var c=app.kendoHelper.getConfigSwitch(a.switchOptions);s.appendTo(e).kendoMobileSwitch(c,n)}else if("checkbox"==a.inputType||"boolean"==a.type){var d=app.common.generateId();s=$('<input id="'+d+'" name="'+t.field+'" class="k-checkbox" type="checkbox" ><label class="k-checkbox-label" for="'+d+'"></label>'),s.appendTo(e)}else if("date"==a.inputType){s.attr("cron-date",""),s.attr("options",JSON.stringify(a.dateOptions)),s.data("initial-date",t.model[t.field]),s.appendTo(e).off("change");var u=setInterval(function(){if($("#"+l).length>0){var e=angular.element($("#"+l));$compile(e)(n),clearInterval(u),$("#"+l).on("change",function(){setTimeout(function(){t.model[t.field]=$("#"+l).data("rawvalue"),t.model.dirty=!0,t.model.dirtyFields[t.field]=!0}.bind(this))})}},10)}else{s.attr("type",a.type),s.attr("mask",a.format?a.format:""),s.attr("class","k-input k-textbox"),s.data("initial-value",t.model[t.field]),s.appendTo(e);var u=setInterval(function(){if($("#"+l).length>0){$("#"+l).off("change"),$("#"+l).on("change",function(){t.model[t.field]=$("#"+l).data("rawvalue"),t.model.dirty=!0,t.model.dirtyFields[t.field]=!0});var e=angular.element($("#"+l));$compile(e)(n),clearInterval(u)}},10)}}function c(t,a){return"popupCustom"==t.editable||"datasource"==t.editable?{name:app.common.generateId(),text:"",iconClass:"k-icon k-i-edit",className:"k-grid-edit",click:function(a){a.preventDefault();var o=$(a.target).closest("tr"),i=(o.closest("table"),this.dataItem(o)),r=this.dataSource.transport.options.cronappDatasource;n.safeApply(function(){m.addButtonsInModal(e.popupEdit,r.name,n);var a=r.goTo(i);r.startEditing(a,function(e){}),"datasource"!=t.editable&&cronapi.screen.showModal(e.popupEdit)})}}:{name:a,text:{edit:" ",update:" ",cancel:" "}}}function d(e,t){return"popupCustom"==e.editable||"datasource"==e.editable?{name:app.common.generateId(),text:"",iconClass:"k-icon k-i-close",className:"k-grid-delete",click:function(e){e.preventDefault();var t=$(e.target).closest("tr"),a=this.dataItem(t),o=this.dataSource.transport.options.cronappDatasource,i=this;n.safeApply(function(){var e,t=o.goTo(a);o.active.__status&&"inserted"==o.active.__status&&(e=function(e){i.dataSource.remove(a)}),o.remove(t,e)})}}:{name:t,text:" "}}function u(e){if(e&&e.aggregates){var t=[];if(e.aggregates.forEach(function(e){t.push(e.type)}),t.length>0)return t}}function p(e,t){if(e&&e.aggregates){var n=[];return e.aggregates.forEach(function(a){var o="#="+a.type+"#";"average"!=a.type&&"sum"!=a.type||(o="#=useMask("+a.type+",'"+e.format+"','"+e.type+"')#"),t?n.push(a.groupFooterTemplate+": "+o):n.push(a.footerTemplate+": "+o)}),n.join("<br/>")}}function g(e){if(e.type.startsWith("date")||e.type.startsWith("month")||e.type.startsWith("time")||e.type.startsWith("week")||e.type.startsWith("money")||e.type.startsWith("number")||e.type.startsWith("tel")||e.format&&"null"!=e.format)return e.headerText+": #=useMask(value,'"+e.format+"','"+e.type+"')#"}var m=this,f=[];return e.columns&&e.columns.forEach(function(t){if("Database"==t.dataType){var i={field:t.field,title:t.headerText,type:t.type,width:t.width,sortable:t.sortable,filterable:t.filterable,hidden:!t.visible};i.template=a(t),i.format=o(t),i.editor=l.bind(this)(t),i.aggregates=u(t),i.footerTemplate=p(t,!1),i.groupFooterTemplate=p(t,!0),i.groupHeaderTemplate=g(t),f.push(i)}else if("Command"==t.dataType){if("no"!=e.editable){var r=t.command.split("|"),s=[];r.forEach(function(t){var n;n="edit"==t?c.bind(this)(e,t):d.bind(this)(e,t),s.push(n)}.bind(this));var i={command:s,title:t.headerText,width:t.width?t.width:155,hidden:!t.visible};f.push(i)}}else if("Blockly"==t.dataType||"Customized"==t.dataType){var v=void 0==t.label?"":t.label;t.iconClass&&v&&(v="&nbsp;"+v);var i={command:[{name:app.common.generateId(),text:v,hidden:!t.visible,className:"k-custom-command"+(v?" k-button-with-label":""),iconClass:t.iconClass,click:function(e){e.preventDefault();var a=$(e.target).closest("tr"),o=a.closest("table"),i=this.dataItem(a),r=$(o.find("tbody")[0]).children().index(a),l={item:i,index:r},s=void 0;s="Customized"==t.dataType?t.execute:m.generateBlocklyCall(t.blocklyInfo);var c=this.dataSource.transport.options.cronappDatasource;if(!c.inserting&&!c.editing){var a=e.currentTarget.parentElement.parentElement;this.select(a)}var d={currentData:c.data,datasource:c,selectedIndex:r,index:r,selectedRow:i,consolidated:l,item:i,selectedKeys:c.getKeyValues(c.active,!0)};n.$eval(s,d)}}],width:t.width,title:t.headerText?t.headerText:""};f.push(i)}}.bind(this)),f},getPageAble:function(e){var t={refresh:e.allowRefreshGrid,pageSizes:e.allowSelectionTotalPageToShow,buttonCount:5};return e.allowPaging||(t=e.allowPaging),t},getToolbar:function(e,t){var n=[];return e.toolBarButtons.forEach(function(a){if("Native"==a.type)if("no"!=e.editable)if("datasource"!=e.editable&&"popupCustom"!=e.editable||"create"!=a.title)n.push(a.title);else{var o=e.dataSourceScreen.name,i=e.popupInsert;a.methodCall=o+".startInserting();","popupCustom"==e.editable&&(a.methodCall=a.methodCall+" cronapi.screen.showModal('"+i+"');");var r=this.generateToolbarButtonCall(a,t,e);n.push(r),this.addButtonsInModal(i,o,t)}else"pdf"!=a.title&&"excel"!=a.title||n.push(a.title);else if("Blockly"==a.type||"Customized"==a.type){var l=this.generateToolbarButtonCall(a,t,e);n.push(l)}else if("SaveOrCancelChanges"==a.type){if("no"!=e.editable){var s=this.generateToolbarButtonCall(a,t,e);n.push(s)}}else if("Template"==a.type||"Title"==a.type){var c={template:a.template};n.push(c)}}.bind(this)),0==n.length&&(n=void 0),n},getEditable:function(e){var t={mode:e.editable,confirmation:!1};return"batch"==e.editable?t=!0:"no"!=e.editable&&"popupCustom"!=e.editable&&"datasource"!=e.editable||(t=!1),t},generateKendoGridInit:function(e,t,n,a){function o(e){if(e.masterRow.find("a").hasClass("k-i-expand"))return void l(this,e.detailRow,e.masterRow);var n=this.dataSource.transport.options.cronappDatasource;n.inserting||n.editing?r(this,null,null):(this.selectable?this.select(e.masterRow):(s.bind(this)(e.data),r(this,e.detailRow,e.masterRow)),e.sender.options.listCurrentOptions.forEach(function(n){var a=i.generateKendoGridInit(n,t),o=$("<div/>").appendTo(e.detailCell).kendoGrid(a).data("kendoGrid");o.dataSource.transport.options.grid=o}))}var i=this,r=function(e,t,n){e.table.find(".k-master-row").each(function(){null!=n&&this==n[0]||e.collapseRow(this)}),e.table.find(".k-detail-row").each(function(){null!=t&&this==t[0]||$(this).remove()})},l=function(e,t,n){e.table.find(".k-master-row").each(function(){null==n&&this!=n[0]||e.collapseRow(this)}),e.table.find(".k-detail-row").each(function(){null==t&&this!=t[0]||$(this).remove()})},s=function(e){var n=this.dataSource.transport.options.cronappDatasource;n.inserting||n.editing||t.safeApply(n.goTo(e))},c=function(e){if(e.sender.tbody&&e.sender.tbody.length){var n=e.sender.tbody;n.parent()&&n.parent().parent()&&n.parent().parent().parent()&&(n=n.parent().parent().parent()),t.safeApply(function(){var e=$(n),a=angular.element(e);$compile(a)(t)})}},d=app.kendoHelper.getDataSource(e.dataSourceScreen.entityDataSource,t,e.allowPaging,e.pageCount,e.columns),u=this.getColumns(e,d,t),p=this.getPageAble(e),g=this.getToolbar(e,t),m=this.getEditable(e),f=(function(e){var t=!1;if(e.columns)for(var n=0;n<e.columns.length;n++)if("Database"==e.columns[n].dataType&&e.columns[n].filterable){t=!0;break}}(e),{toolbar:g,pdf:{allPages:!0,avoidLinks:!0,paperSize:"A4",margin:{top:"2cm",left:"1cm",right:"1cm",bottom:"1cm"},landscape:!0,repeatHeaders:!0,scale:.8},dataSource:d,editable:m,height:e.height,groupable:e.allowGrouping,sortable:e.allowSorting,filterable:!0,pageable:p,columns:u,selectable:e.allowSelectionRow,detailInit:e.details&&e.details.length>0?o:void 0,listCurrentOptions:e.details&&e.details.length>0?e.details:void 0,edit:function(e){this.dataSource.transport.options.disableAndSelect(e);var n=e.container,o=this.dataSource.transport.options.cronappDatasource;if(e.model.isNew()&&!e.model.dirty){var i=e.model;o.startInserting(null,function(e){for(var t in e)if(i.fields[t]){if(i.fields[t].validation&&i.fields[t].validation.required){var a=n.find("input[name='"+t+"']");a.length&&a.val(e[t]).trigger("change")}i.set(t,e[t])}})}else e.model.isNew()||e.model.dirty||t.safeApply(function(){var t=o.goTo(e.model);o.startEditing(t,function(e){})});a.ngEdit&&t.$eval(a.ngEdit),c(e)},change:function(e){var o=this.dataItem(this.select());s.bind(this)(o);var i=this.dataSource.transport.options.cronappDatasource;n&&n.$setViewValue(i.active),r(this,this.select().next(),this.select()),a.ngChange&&t.$eval(a.ngChange),c(e)},cancel:function(e){var n=this.dataSource.transport.options.cronappDatasource;t.safeApply(n.cancel()),this.dataSource.transport.options.enableAndSelect(e),setTimeout(function(){a.ngCancel&&t.$eval(a.ngCancel),c(e)}.bind(this))},dataBound:function(e){this.dataSource.transport.options.selectActiveInGrid(),a.ngDataBound&&t.$eval(a.ngDataBound),c(e)}});return f.beforeEdit=a.ngBeforeEdit?function(e){t.$eval(a.ngBeforeEdit)}:void 0,f.dataBinding=a.ngDataBinding?function(e){t.$eval(a.ngDataBinding)}:void 0,f.save=a.ngSave?function(e){t.$eval(a.ngSave)}:void 0,f.saveChanges=a.ngSaveChanges?function(e){t.$eval(a.ngSaveChanges)}:void 0,f.remove=a.ngRemove?function(e){t.$eval(a.ngRemove)}:void 0,f},link:function(e,t,n,a){var o=$("<div></div>"),i="plugins/cronapp-lib-js/dist/js/kendo-ui/js/messages/kendo.messages.";"pt_br"==$translate.use()?i+="pt-BR.min.js":i+="en-US.min.js",this.initCulture();var r=this;$.getScript(i,function(){var t=JSON.parse(n.options||"{}");"datasource"!=t.editable&&e[t.dataSourceScreen.entityDataSource.name]&&!e[t.dataSourceScreen.entityDataSource.name].dependentLazyPost&&(e[t.dataSourceScreen.entityDataSource.name].batchPost=!0,t.toolBarButtons=t.toolBarButtons||[],t.toolBarButtons.push({type:"SaveOrCancelChanges",title:$translate.instant("SaveChanges"),methodCall:t.dataSourceScreen.entityDataSource.name+".postBatchData()",saveButton:!0}),t.toolBarButtons.push({type:"SaveOrCancelChanges",title:$translate.instant("CancelChanges"),methodCall:t.dataSourceScreen.entityDataSource.name+".cancelBatchData()",saveButton:!1}));var i=r.generateKendoGridInit(t,e,a,n),l=o.kendoGrid(i).data("kendoGrid");l.dataSource.transport.options.grid=l,e.safeApply(function(){e[t.dataSourceScreen.entityDataSource.name]&&(o.find(".k-filter-row").show(),o.find(".k-pager-sizes").show(),o.find(".k-pager-nav").show(),o.find(".k-pager-numbers").show(),o.find(".k-pager-refresh.k-link").show(),o.find(".saveorcancelchanges").hide(),e[t.dataSourceScreen.entityDataSource.name].addDataSourceEvents({pendingchanges:function(e){e?(o.find(".k-filter-row").hide(),o.find(".k-pager-sizes").hide(),o.find(".k-pager-nav").hide(),o.find(".k-pager-numbers").hide(),o.find(".k-pager-refresh.k-link").hide(),o.find(".saveorcancelchanges").show()):(o.find(".k-filter-row").show(),o.find(".k-pager-sizes").show(),o.find(".k-pager-nav").show(),o.find(".k-pager-numbers").show(),o.find(".k-pager-refresh.k-link").show(),o.find(".saveorcancelchanges").hide())}}),e[t.dataSourceScreen.entityDataSource.name].addDataSourceEvents({afterchanges:function(e){}}))})}),t.html(o),$compile(o)(t.scope())}}}]).directive("cronSelect",["$compile",function(e){return{restrict:"E",replace:!0,require:"ngModel",link:function(e,t,n,a){var o={};try{o=JSON.parse(n.options)}catch(e){console.log("ComboBox invalid configuration! "+e)}var i=n.id?' id="'+n.id+'"':"",r=n.name?' name="'+n.name+'"':"",l=t.parent();$(l).append('<input style="width: 100%;" '+i+r+' class="cronSelect" ng-model="'+n.ngModel+'"/>');var s=$(l).find("input.cronSelect"),c=app.kendoHelper.getConfigCombobox(o,e);c.close=n.ngClose?function(){e.$eval(n.ngClose)}:void 0,c.dataBound=n.ngDataBound?function(){e.$eval(n.ngDataBound)}:void 0,c.filtering=n.ngFiltering?function(){e.$eval(n.ngFiltering)}:void 0,c.open=n.ngOpen?function(){e.$eval(n.ngOpen)}:void 0,c.select=n.ngSelect?function(){e.$eval(n.ngSelect)}:void 0,c.change=function(){u.$apply(function(){p.$setViewValue(this.value())}.bind(d))};var d=s.kendoComboBox(c).data("kendoComboBox");$(t).remove();var u=e,p=a,g=!0;a&&(a.$formatters.push(function(t){var a="";return("boolean"==typeof t||t)&&(a=t),d.value(a),g||n.ngChange&&e.$eval(n.ngChange),g=!1,d.value(a),a}),a.$parsers.push(function(e){return"boolean"==typeof e||e?e:null}))}}}]).directive("cronDynamicSelect",["$compile","$timeout","$parse",function($compile,$timeout,$parse){return{restrict:"E",replace:!0,require:"?ngModel",goTo:function(e,t,n){if(dataSourceScreen=$(t).data("dataSourceScreen"),null!=dataSourceScreen)return dataSourceScreen.goTo(n,!0)},compileAngular:function(e,t){var n=$(t),a=angular.element(n);$compile(a)(e)},getActive:function(active){if(active&&active.indexOf(".active."))try{return eval(active.substr(0,active.indexOf(".active.")))}catch(e){}return null},getFieldText:function(e,t){if(e&&e.indexOf(".active.")&&t.dataTextField)try{return e.substr(e.indexOf(".active.")+8)+"_"+t.dataTextField}catch(e){}return null},isDefaultEntity:function(e){if(e&&e.entity){var t=e.entity.split("/");if(t&&t.length>0)return-1==t.pop().indexOf("query")}return!1},getModelParent:function(e){if("string"==typeof e&&e.length>9&&e.indexOf("|raw}}")>0){e=e.trim();var t=e.substr(e.indexOf("{{")+2);return t=t.substr(0,t.indexOf("|raw}}")),t.trim()}return null},link:function(scope,element,attrs,ngModelCtrl){var modelGetter=$parse(attrs.ngModel),modelSetter=modelGetter.assign,select={},self=this,parentDS={},textField=null;try{select=JSON.parse(attrs.options),parentDS=this.getActive(attrs.ngModel),textField=this.getFieldText(attrs.ngModel,select)}catch(e){console.log("DynamicComboBox invalid configuration! "+e)}var options=app.kendoHelper.getConfigCombobox(select,scope);options.autoBind=!1;var dataSourceScreen=null;try{delete options.dataSource.schema.model.id,dataSourceScreen=eval(select.dataSourceScreen.name),dataSourceScreen.rowsPerPage=dataSourceScreen.rowsPerPage?dataSourceScreen.rowsPerPage:100,options.dataSource.transport.origin="combobox"}catch(e){}options.virtual={},options.virtual.itemHeight=26;var _scope=scope,_goTo=this.goTo,_compileAngular=this.compileAngular;if(options.dataSource.pageSize&&options.dataSource.pageSize>0){options.height=options.dataSource.pageSize*options.virtual.itemHeight/4,options.virtual.mapValueTo="dataItem";var _options=options;options.virtual.valueMapper=function(e){var t=_options.combobox;if(e.value){t.isEvaluating=!0;var n=_options.dataSource.transport.options.cronappDatasource;n.findObj([e.value],!1,function(a){e.success(a),t.isEvaluating=!1,select.changeCursor?scope.safeApply(function(){if(null!=a){_goTo(_scope,t,a)||(n.data.push(a),_goTo(_scope,t,a))}else modelSetter(_scope,null)}):null==a&&modelSetter(_scope,null)},function(){e.success(null),t.isEvaluating=!1})}else e.success(null)}}options.change=attrs.ngChange?function(){scope.$eval(attrs.ngChange)}:void 0,options.close=attrs.ngClose?function(){scope.$eval(attrs.ngClose)}:void 0,options.dataBound=attrs.ngDataBound?function(){scope.$eval(attrs.ngDataBound)}:void 0,options.filtering=attrs.ngFiltering?function(){scope.$eval(attrs.ngFiltering)}:void 0,options.open=function(e){dataSourceScreen.fetched||(combobox.options.firstLazyRead=!0,combobox.dataSource.read()),attrs.ngOpen&&scope.$eval(attrs.ngOpen)(e)},options.select=attrs.ngSelect?function(){scope.$eval(attrs.ngSelect)}:void 0;var parent=element.parent(),id=attrs.id?' id="'+attrs.id+'"':"",name=attrs.name?' name="'+attrs.name+'"':"",required="";(attrs.ngRequired||attrs.required)&&(required=" required "),$(parent).append('<input style="width: 100%;"'+id+name+required+' class="cronDynamicSelect" ng-model="'+attrs.ngModel+'"/>');var $element=$(parent).find("input.cronDynamicSelect"),combobox=$element.kendoDropDownList(options).data("kendoDropDownList");options.combobox=combobox,null!=dataSourceScreen&&void 0!=dataSourceScreen&&$(combobox).data("dataSourceScreen",dataSourceScreen),(attrs.ngRequired||attrs.required)&&($(combobox.element[0]).attr("style",""),$(combobox.element[0]).attr("class","cron-select-offscreen"));var forceChangeModel=function(e){if(combobox.value(e),select.changeCursor&&!combobox.isEvaluating)if(null==e||void 0==e)dataSourceScreen.active={},dataSourceScreen.cursor=-1;else{var t=_goTo(_scope,combobox,combobox.dataItem());t||(dataItem=objectClone(combobox.dataItem(),combobox.dataSource.options.schema.model.fields),dataSourceScreen.data.push(dataItem),_goTo(_scope,combobox,dataItem))}},defineInitialValue=function(){if(!combobox.isEvaluating){var e=combobox.value(),t=null,n=dataSourceScreen.goTo(e);n||(!combobox.options.lazyFirstInitialValue&&dataSourceScreen.lazy||void 0==select.initValue||null==select.initValue||(combobox.options.lazyFirstInitialValue=!1,(n=dataSourceScreen.goTo(select.initValue))&&(t=select.initValue)),null==t&&select.firstValue&&dataSourceScreen&&dataSourceScreen.data.length&&(t=dataSourceScreen.data[0][select.dataValueField]),modelSetter(_scope,t),forceChangeModel(t))}},_ngModelCtrl=ngModelCtrl;null!=dataSourceScreen&&void 0!=dataSourceScreen&&dataSourceScreen.addDataSourceEvents({refresh:function(){defineInitialValue()},read:function(e){var t=combobox.options.fromCombo;combobox.options.fromCombo=!1,t||(combobox.options.readData=e,this.dataSource.read(),combobox.options.lazyFirstValue&&(combobox.options.lazyFirstValue=!1,defineInitialValue()))}.bind(combobox)});var _isDefaultEntity=this.isDefaultEntity;if($element.on("change",function(e){_scope.$apply(function(){modelSetter(_scope,combobox.dataItem()[select.dataValueField])}),_compileAngular(scope,options.combobox.element[0])}),ngModelCtrl&&(ngModelCtrl.$formatters.push(function(e){combobox.value();return forceChangeModel(e)}),ngModelCtrl.$parsers.push(function(e){if("boolean"==typeof e||e)if(!0===combobox.options.valuePrimitive){if("string"==typeof e)return e;if("boolean"==typeof e[select.dataValueField]||e[select.dataValueField])return e[select.dataValueField]}else try{return objectClone(e,combobox.dataSource.options.schema.model.fields)}catch(e){}return null})),select.initValue)if(select.initValue.startsWith("params.")){var type=combobox.dataSource.options.schema.model.fields[select.dataValueField].type;select.initValue=scope.$eval(select.initValue),"string"!=type&&(select.initValue=dataSourceScreen.normalizeValue(select.initValue,!0))}else select.initValue=scope.$eval(select.initValue);else select.initValue=null;""==select.initValue&&(select.initValue=null),combobox.dataSource.transport&&combobox.dataSource.transport.options&&(combobox.dataSource.transport.options.combobox=combobox,combobox.dataSource.transport.options.$compile=$compile,combobox.dataSource.transport.options.scope=scope,combobox.dataSource.transport.options.ngModelCtrl=ngModelCtrl,combobox.dataSource.transport.options.initRead=!0,void 0!=select.initValue&&null!=select.initValue?(modelSetter(_scope,select.initValue),combobox.options.lazyFirstInitialValue=!0):select.firstValue&&(combobox.options.lazyFirstValue=!0,dataSourceScreen.lazy&&!dataSourceScreen.fetched&&dataSourceScreen.fetch({}))),$(combobox.span).on("DOMSubtreeModified",function(e){_compileAngular(scope,e.target)}),$(combobox.ul).on("DOMSubtreeModified",function(e){$timeout(function(){_compileAngular(scope,e.target)})}),_compileAngular(scope,combobox.span),_compileAngular(scope,combobox.ul),$(element).remove()}}}]).directive("cronMultiSelect",["$compile",function($compile){return{restrict:"E",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){var _self=this,select={};try{select=JSON.parse(attrs.options)}catch(e){console.log("MultiSelect invalid configuration! "+e)}var _scope=scope,_ngModelCtrl=ngModelCtrl,relactionDS={relationDataSource:null!=select.relationDataSource?eval(select.relationDataSource.name):null,relationField:null!=select.relationField?select.relationField:""},options=app.kendoHelper.getConfigCombobox(select,scope);try{delete options.dataSource.schema.model.id}catch(e){}var parent=element.parent(),id=attrs.id?' id="'+attrs.id+'"':"",name=attrs.name?' name="'+attrs.name+'"':"";$(parent).append('<input style="width: 100%;"'+id+name+' class="cronMultiSelect" ng-model="'+attrs.ngModel+'"/>');var $element=$(parent).find("input.cronMultiSelect");$(element).remove();var evtSelect,deselect;options.deselect=function(e){var t=e.dataItem,n=this.relationDataSource,a=e.sender.options.dataValueField,o=null;if(n&&n.data&&t[a]){for(key in n.data){var i=n.data[key];if(i[this.relationField]&&i[this.relationField]==t[a]){o=i;break}}null!=o&&($(combobox).data("silent",!0),this.relationDataSource.removeSilent(o,null,null)),deselect&&deselect()}}.bind(relactionDS),options.select=function(e){var t=e.dataItem,n=e.sender.options.dataValueField;if(this.relationDataSource&&t[n]){var a={};a[this.relationField]=t[n];var o=e.sender;$(o).data("silent",!0),this.relationDataSource.startInserting(a,function(e){this.postSilent()}.bind(this.relationDataSource))}evtSelect&&evtSelect()}.bind(relactionDS),options.change=attrs.onChange?function(){eval(attrs.onChange)}:void 0,options.close=attrs.onClose?function(){eval(attrs.onClose)}:void 0,options.dataBound=attrs.onDatabound?function(){eval(attrs.onDatabound)}:void 0,options.filtering=attrs.onFiltering?function(){eval(attrs.onFiltering)}:void 0,options.open=attrs.onOpen?function(){eval(attrs.onOpen)}:void 0,options.cascade=attrs.onCascade?function(){eval(attrs.onCascade)}:void 0,evtSelect=attrs.onSelect?function(){eval(attrs.onSelect)}:void 0,deselect=attrs.onDeselect?function(){eval(attrs.onDeselect)}:void 0;var combobox=$element.kendoMultiSelect(options).data("kendoMultiSelect"),convertArray=function(e){var t=[];if(e)for(var n in e)t.push(e[n][relactionDS.relationField]);return t};scope.$watchCollection(function(){return ngModelCtrl.$modelValue},function(e,t){var n=$(combobox).data("silent");$(combobox).data("silent",!1),n||JSON.stringify(e)===JSON.stringify(t)||combobox.value(convertArray(e))})}}}]).directive("cronAutoComplete",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var o={};try{o=JSON.parse(n.options)}catch(e){console.log("AutoComplete invalid configuration! "+e)}try{delete i.dataSource.schema.model.id}catch(e){}var i=app.kendoHelper.getConfigCombobox(o,e);i.change=n.ngChange?function(){e.$eval(n.ngChange)}:void 0,i.close=n.ngClose?function(){e.$eval(n.ngClose)}:void 0,i.dataBound=n.ngDataBound?function(){e.$eval(n.ngDataBound)}:void 0,i.filtering=n.ngFiltering?function(){e.$eval(n.ngFiltering)}:void 0,i.open=n.ngOpen?function(){e.$eval(n.ngOpen)}:void 0,i.select=n.ngSelect?function(){e.$eval(n.ngSelect)}:void 0;var r=t.parent(),l=n.id?' id="'+n.id+'"':"",s=n.name?' name="'+n.name+'"':"",c="";(n.ngRequired||n.required)&&(c=" required "),$(r).append('<input style="width: 100%;" '+l+s+c+' class="cronAutoComplete" ng-model="'+n.ngModel+'"/>');var d=$(r).find("input.cronAutoComplete");$(t).remove(),i.change=function(t){e.$apply(function(){a.$setViewValue(d.val())})};var u=d.kendoAutoComplete(i).data("kendoAutoComplete");a&&(a.$formatters.push(function(e){return u.value(e),e}),a.$parsers.push(function(e){if(e){if("string"==typeof e)return e;if(e[o.dataTextField])return e[o.dataTextField]}return null}))}}}]).directive("cronDate",["$compile","$translate","$window",function(e,t,n){return{restrict:"AE",require:"?ngModel",link:function(e,n,a,o){var i={},r={};try{if(a.options)r=JSON.parse(a.options);else{var l=window.buildElementOptions(n);r=JSON.parse(l)}r.format||(r.format=parseMaskType(r.type,t)),i=app.kendoHelper.getConfigDate(t,r)}catch(e){console.log("AutoComplete invalid configuration! "+e)}var s="date"==i.type||"datetime"==i.type||"time"==i.type,c=$(n);if(!c.data("alreadycompiled")){if(c.data("alreadycompiled",!0),a.fromGrid)c=$(n);else{var d=n.parent(),u=$('<input style="width: 100%;" class="cronDate" ng-model="'+a.ngModel+'"/>');$(d).append(u),c=$(d).find("input.cronDate"),c.data("type",i.type),c.attr("type","date")}var p=app.kendoHelper.buildKendoMomentPicker(c,i,e,o);if(a.fromGrid){var g=c.data("initial-date"),m=function(){var e=null,t=$(this).val();g&&(t=g,g=void 0),e=s?moment.utc(t,i.momentFormat):moment(t,i.momentFormat),p.value(e.format(i.momentFormat)),$(this).data("rawvalue",e.toDate())};$(n).on("keydown",m).on("keyup",m).on("change",m),m.bind(c)()}else o&&(o.$formatters.push(function(e){var t=null;if(e){var n=null;n=s?moment.utc(e):moment(e),t=n.format(i.momentFormat)}return p.value(t),t}),o.$parsers.push(function(e){if(e){var t=null;return t=s?moment.utc(p._oldText,i.momentFormat):moment(p._oldText,i.momentFormat),t.toDate()}return null})),$(n).remove()}}}}]).directive("cronSlider",["$compile",function(e){return{restrict:"E",require:"ngModel",getActive:function(e,t){if(e&&e.indexOf(".active."))try{return t.$eval(e.substr(0,e.indexOf(".active.")))}catch(e){}},link:function(t,n,a,o){var i={};try{i=JSON.parse(a.options)}catch(e){console.log("Slider invalid configuration! "+e)}var r=app.kendoHelper.getConfigSlider(i),l=this.getActive(a.ngModel,t);r.change=function(){t.$apply(function(){var e=$(n).val();l&&(e=l.normalizeValue(e,!0)),o.$setViewValue(e),a.ngChange&&t.$eval(a.ngChange)})},r.slide=a.ngSlide?function(){t.$eval(a.ngSlide)}:void 0;var i=$(n).kendoSlider(r).data("kendoSlider");if(a.ngRequired||a.required){var s=a.id?' id="input'+app.common.generateId()+'"':"",c=a.name?' name="input'+app.common.generateId()+'"':"",d=n.parent()
;$(d).append('<input autocomplete="off" tabindex="-1" style="width: 100%;"'+s+c+' required class="cronSlider cron-select-offscreen" ng-model="'+a.ngModel+'"/>');var u=$(d).find("input.cronSlider");e(u)(n.scope())}t.$watch(function(){return o.$modelValue},function(e,t){e!==t&&(e?i.value(e):i.value(i.min()))}),o&&(o.$formatters.push(function(e){var t=null;return!e&&i.min?t=i.min:e&&(t=e),i.value(t),t}),o.$parsers.push(function(e){return e||null}))}}}]).directive("cronSwitch",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var o={};try{var i=window.buildElementOptions(t);o=JSON.parse(i)}catch(e){console.log("Switch invalid configuration! "+e)}var r=app.kendoHelper.getConfigSwitch(o),l=t.parent();$(l).append('<input style="width: 100%;" class="cronSwitch" ng-model="'+n.ngModel+'"/>');var s=$(l).find("input.cronSwitch"),c=function(t){e.$apply(function(){a.$setViewValue(this.value())}.bind(this))};r.change=c;var d=s.kendoMobileSwitch(r).data("kendoMobileSwitch");$(t).remove(),a&&(a.$formatters.push(function(e){var t=!1;return void 0!=e&&(t=e),d.value(t),t}),a.$parsers.push(function(e){return void 0!=e&&e}))}}}]).directive("cronBarcode",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var o={};try{var i=window.buildElementOptions(t);o=JSON.parse(i)}catch(e){console.log("Barcode invalid configuration! "+e)}var r=app.kendoHelper.getConfigBarcode(o),l=t.parent();$(l).append('<span class="cronBarcode" ng-model="'+n.ngModel+'"></span>');var s=$(l).find("span.cronBarcode"),c=s.kendoBarcode(r).data("kendoBarcode");$(t).remove(),e.$watch(function(){return a.$modelValue},function(e,t){var n="";e!==t&&(n=e),r.value=n,c.setOptions(r)})}}}]).directive("cronQrcode",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(e,t,n,a){var o={};try{var i=window.buildElementOptions(t);o=JSON.parse(i)}catch(e){console.log("Qrcode invalid configuration! "+e)}var r=app.kendoHelper.getConfigQrcode(o),l=t.parent();$(l).append('<span class="cronQrcode" ng-model="'+n.ngModel+'"></span>');var s=$(l).find("span.cronQrcode"),c=s.kendoQRCode().data("kendoQRCode");$(t).remove(),e.$watch(function(){return a.$modelValue},function(e,t){var n="";e!==t&&(n=e),r.value=n,c.setOptions(r)})}}}])}(app),app.kendoHelper={getSchema:function(e){var t=[{kendoType:"string",entityType:["string","character","uuid","guid"]},{kendoType:"number",entityType:["integer","long","double","int","float","bigdecimal","single","int32","int64","decimal","byte"]},{kendoType:"date",entityType:["date","time","datetime"]},{kendoType:"boolean",entityType:["boolean"]}],n=function(e){for(var n=0;n<t.length;n++)if(t[n].entityType.includes(e.toLocaleLowerCase()))return t[n].kendoType;return"string"},a={model:{id:"__$id",fields:{}}};return e&&e.schemaFields&&(e.schemaFields.forEach(function(e){a.model.fields[e.name]={type:n(e.type),editable:!0,nullable:e.nullable,validation:{required:!e.nullable}}}),a.model.fields.__$id={type:"string",editable:!0,nullable:!0,validation:{required:!1}}),a},getDataSource:function(e,t,n,a,o){function i(e){if(e.response&&e.response.d){var t=null;t=e.response.d.results?e.response.d.results:[e.response.d],this.group().length?o.forEach(function(e){if("Database"==e.dataType){if("datetime-local"==e.type||"month"==e.type||"time-local"==e.type||"week"==e.type)for(var n=0;n<t.length;n++){var a=t[n];e.field==a.Member&&(a.Key=a.Key.replace(/\d+/,function(e){return parseInt(e)+d})),r.bind(this)(a.Items)}}}):r.bind(this)(t)}}function r(e){for(var t=0;t<e.length;t++)o&&o.forEach(function(n){if("Database"==n.dataType){("datetime-local"==n.type||"month"==n.type||"time-local"==n.type||"week"==n.type)&&e[t][n.field]&&(e[t][n.field]=e[t][n.field].replace(/\d+/,function(e){return parseInt(e)+d}))}})}var l=this.getSchema(e);o&&o.forEach(function(e){for(var t in l.model.fields)if("Database"==e.dataType&&e.field==t){l.model.fields[t].nullable=!e.required,l.model.fields[t].validation.required=e.required;break}});var s=function(e){for(var t in e)if(l.model.fields.hasOwnProperty(t)){var n=l.model.fields[t];"string"==n.type&&void 0!=e[t]?e[t]=e[t]+"":"number"==n.type&&void 0!=e[t]?e[t]=parseFloat(e[t]):"date"==n.type&&void 0!=e[t]?e[t]="/Date("+e[t].getTime()+")/":"boolean"==n.type&&(void 0==e[t]?e[t]=!1:e[t]="true"==e[t].toString().toLowerCase()),l.model.id==t&&void 0!=e[t]&&0==e[t].toString().length&&delete e[t]}return e},c=10;t[e.name]&&(c=t[e.name].rowsPerPage);var d=6e4*(new Date).getTimezoneOffset(),u=app.common.generateId(),p={transport:{setActiveAndPost:function(e){var n=this.options.cronappDatasource;t.safeApply(n.updateActive(s(e.data))),n.active.__sender=u,n.postSilent(function(t){this.options.enableAndSelect(e),e.success(t)}.bind(this),function(t){this.options.enableAndSelect(e),e.error(t,t,t)}.bind(this))},push:function(e){!this.options.dataSourceEventsPush&&this.options.cronappDatasource&&(this.options.dataSourceEventsPush={create:function(t){if(this.options.isGridInDocument(this.options.grid)){this.options.getCurrentCallbackForPush(e,this.options.grid).pushUpdate(t)}else this.options.cronappDatasource.removeDataSourceEvents(this.options.dataSourceEventsPush)}.bind(this),update:function(t){if(this.options.isGridInDocument(this.options.grid)){this.options.getCurrentCallbackForPush(e,this.options.grid).pushUpdate(t)}else this.options.cronappDatasource.removeDataSourceEvents(this.options.dataSourceEventsPush)}.bind(this),delete:function(t){if(this.options.isGridInDocument(this.options.grid)){this.options.getCurrentCallbackForPush(e,this.options.grid).pushDestroy(t)}else this.options.cronappDatasource.removeDataSourceEvents(this.options.dataSourceEventsPush)}.bind(this),overRideRefresh:function(e){this.options.isGridInDocument(this.options.grid)&&this.options.grid.dataSource.read()}.bind(this),read:function(e){this.options.isGridInDocument(this.options.grid)&&(this.options.fromRead=!0,this.options.grid.dataSource.read())}.bind(this),memorycreate:function(t){if(this.options.isGridInDocument(this.options.grid)){this.options.getCurrentCallbackForPush(e,this.options.grid).pushUpdate(t)}else this.options.cronappDatasource.removeDataSourceEvents(this.options.dataSourceEventsPush)}.bind(this),memoryupdate:function(t){if(this.options.isGridInDocument(this.options.grid)){this.options.getCurrentCallbackForPush(e,this.options.grid).pushUpdate(t)}else this.options.cronappDatasource.removeDataSourceEvents(this.options.dataSourceEventsPush)}.bind(this),memorydelete:function(t){if(this.options.isGridInDocument(this.options.grid)){this.options.getCurrentCallbackForPush(e,this.options.grid).pushDestroy(t)}}.bind(this)},"combobox"==this.origin&&delete this.options.dataSourceEventsPush.overRideRefresh,this.options.cronappDatasource.addDataSourceEvents(this.options.dataSourceEventsPush))},read:function(t){var n=!1;try{var a=this.options.cronappDatasource;this.options.grid;this.options.kendoCallback?this.options.fromRead?this.options.kendoCallback.success(a.data):n=!0:(this.options.kendoCallback=t,n=!0)}finally{this.options.fromRead=!1}if(n){for(key in t.data)void 0==t.data[key]&&delete t.data[key];var o=kendo.data.transports.odata.parameterMap(t.data,"read"),i="";this.options.grid&&this.options.grid.dataSource.group().forEach(function(e){i+=e.field+" "+e.dir+","}),i.length>0&&(i=i.substr(0,i.length-1),o.$orderby?o.$orderby=i+","+o.$orderby:o.$orderby=i);var a=this.options.cronappDatasource;if(a.rowsPerPage=t.data.pageSize,a.offset=t.data.page-1,!t.data.pageSize&&(a.offset=void 0,delete o.$skip,this.options.grid&&1!=this.options.grid.dataSource.page()))return this.options.grid.dataSource.page(1),void t.error("canceled","canceled","canceled");var r={};r.params=o;var l=!1;e.append&&(l=e.append),a.append=l,a.fetch(r,{success:function(e){t.success(e)},canceled:function(e){t.error("canceled","canceled","canceled")}},l)}},update:function(e){this.setActiveAndPost(e)},create:function(e){this.setActiveAndPost(e)},destroy:function(e){cronappDatasource=this.options.cronappDatasource,cronappDatasource.removeSilent(e.data,function(t){e.success(t)},function(t){e.error("canceled","canceled","canceled")})},batch:function(e){},options:{fromRead:!1,disableAndSelect:function(e){this.isGridInDocument(this.grid)&&(this.grid.select(e.container),this.grid.options.selectable=!1,this.grid.selectable&&this.grid.selectable.element&&(this.grid.selectable.destroy(),this.grid.selectable=null))},enableAndSelect:function(e){this.isGridInDocument(this.grid)&&(this.grid.options.selectable="row",this.grid._selectable(),this.grid.select(e.container))},selectActiveInGrid:function(e){if(this.isGridInDocument(this.grid)&&this.grid.selectable&&this.grid.dataItems().length>0&&this.cronappDatasource.active&&this.cronappDatasource.active.__$id){for(var t=this.grid.dataItems(),n=-1,a=0;a<t.length;a++)if(this.cronappDatasource.active.__$id==t[a].__$id){n=a;break}n>-1&&this.grid.select(this.grid.table.find("tr")[n])}},isGridInDocument:function(e){return!!e&&$(document).has(e.element[0]).length},getCurrentCallbackForPush:function(e,t){return e||t},cronappDatasource:t[e.name]}},pageSize:c,serverPaging:!0,serverFiltering:!0,serverSorting:!0,batch:!1,schema:l,requestEnd:i};return p.aggregate=function(e){var t=[];return e&&e.forEach(function(e){e.aggregates&&e.aggregates.forEach(function(n){t.push({field:e.field,aggregate:n.type})})}),t}(o),p.schema.total=function(){return p.transport.options.cronappDatasource.getRowsCount()},p},getEventReadCombo:function(e){var t=this.options.cronappDatasource;if(!t)return void e.error("canceled","canceled","canceled");var n;if(this.options.combobox&&this.options.combobox.options.readData)return e.success(this.options.combobox.options.readData),this.options.combobox.options.readData=null,void(this.options.alreadyLoaded=!0);if(this.options.combobox)var n=!this.options.alreadyLoaded;else n=!1;this.options.alreadyLoaded=!0;var a=!0;if(n&&(a=!1,t.lazy?e.success([{}]):e.success([])),a){for(key in e.data)void 0==e.data[key]&&delete e.data[key];var o=kendo.data.transports.odata.parameterMap(e.data,"read");t.rowsPerPage=e.data.pageSize,t.offset=e.data.page-1;var i=this,r={};r.params=o,i.options.combobox&&(i.options.combobox.options.fromCombo=!0),t.fetch(r,{success:function(t){if(e.success&&(e.success(t),i.options&&i.options.combobox&&i.options.combobox.element[0].id)){var n=angular.element($(" .k-animation-container"));i.options.$compile(n)(i.options.scope)}},canceled:function(t){i.options.combobox&&(i.options.combobox.options.fromCombo=!1),e.success&&e.error("canceled","canceled","canceled")},error:function(t){i.options.combobox&&(i.options.combobox.options.fromCombo=!1),e.success&&e.error("error","error","error")}},!1,{ignoreAtive:!0})}},getConfigCombobox:function(e,t){var n=!1,a={},a={},o={};if(e){if(e.dynamic&&"false"!=e.dynamic)e.dataSourceScreen&&e.dataSourceScreen.entityDataSource&&(e.dataSourceScreen.entityDataSource.append=!0,a=app.kendoHelper.getDataSource(e.dataSourceScreen.entityDataSource,t,!0,e.dataSourceScreen.rowsPerPage),a.transport.read=app.kendoHelper.getEventReadCombo,n=null!=e.valuePrimitive&&("string"==typeof e.valuePrimitive?"true"==e.valuePrimitive:e.valuePrimitive));else for(n=!0,e.dataValueField="key",e.dataTextField="value",a.data=null==e.staticDataSource?void 0:e.staticDataSource,i=0;i<a.data.length;i++)try{a.data[i].key=t.$eval(a.data[i].key)}catch(e){a.data[i].key=a.data[i].key}e.dataValueField&&""!=e.dataValueField.trim()||(e.dataValueField=null==e.dataTextField?void 0:e.dataTextField);!e.template&&e.format&&(e.template="#= useMask("+e.dataTextField+",'"+e.format+"','"+function(t){var n=e.dataSourceScreen.entityDataSource.schemaFields;for(count=0;count<n.length;count++)if(t==n[count].name)return n[count].type.toLowerCase();return null}(e.dataTextField)+"') #"),!e.valueTemplate&&e.format&&(e.valueTemplate="#= useMask("+e.dataTextField+",'"+e.format+"') #");var o={dataTextField:null==e.dataTextField?void 0:e.dataTextField,dataValueField:null==e.dataValueField?void 0:e.dataValueField,dataSource:a,headerTemplate:null==e.headerTemplate?void 0:e.headerTemplate,template:null==e.template?void 0:e.template,placeholder:null==e.placeholder?void 0:e.placeholder,footerTemplate:null==e.footerTemplate?void 0:e.footerTemplate,filter:null==e.filter?void 0:e.filter,valuePrimitive:n,optionLabel:null==e.optionLabel||""==e.optionLabel?" ":e.optionLabel,valueTemplate:null==e.valueTemplate?void 0:e.valueTemplate,suggest:!0}}return o},getConfigDate:function(e,t){var n={};if(n){var a=function(e){return e&&(e=e.replace(/:MM/gm,":mm"),e=e.replace(/:M/gm,":m"),e=e.replace(/S/gm,"s"),e=e.replace(/D/gm,"d"),e=e.replace(/Y/gm,"y")),e},o={};if(t.animation)try{o=JSON.parse(t.animation)}catch(e){console.log("DateAnimation invalid configuration! "+e)}var i=function(t,n){return null==n&&(n=parseMaskType(t,e)),n}(t.type,t.format);n={value:null,format:a(i),timeFormat:a(t.timeFormat),momentFormat:i,culture:function(e){e=e.replace(/_/gm,"-");var t=e.split("-");return t[t.length-1]=t[t.length-1].toUpperCase(),t.join("-")}(e.use()),type:null==t.type?void 0:t.type,weekNumber:null==t.weekNumber?void 0:t.weekNumber,dateInput:null==t.dateInput?void 0:t.dateInput,animation:o,footer:null==t.footer?void 0:t.footer,start:null==t.start?void 0:t.start,depth:null==t.start?void 0:t.start}}return n},buildKendoMomentPicker:function(e,t,n,a){var o="date"==t.type||"datetime"==t.type||"time"==t.type;if(!e.attr("from-grid")){var i=function(){var n=e.val();if(n&&""!=n.trim()){var i=null;i=o?moment.utc(n,t.momentFormat):moment(n,t.momentFormat),a&&i.isValid()&&(a.$setViewValue(i.toDate()),e.data("changed",!0))}else a&&a.$setViewValue("")};t.change=n?function(){n.$apply(function(){i()})}:i}return"date"==t.type?e.kendoDatePicker(t).data("kendoDatePicker"):"datetime"==t.type||"datetime-local"==t.type?e.kendoDateTimePicker(t).data("kendoDateTimePicker"):"time"==t.type||"time-local"==t.type?e.kendoTimePicker(t).data("kendoTimePicker"):void 0},getConfigSlider:function(e){e=e||{};var t={increaseButtonTitle:e.increaseButtonTitle,decreaseButtonTitle:e.decreaseButtonTitle,dragHandleTitle:e.dragHandleTitle};try{t.min=e.min?parseInt(e.min):1,t.max=e.max?parseInt(e.max):1,t.smallStep=e.smallStep?parseInt(e.smallStep):1,t.largeStep=e.largeStep?parseInt(e.largeStep):1}catch(e){console.log("Slider invalid configuration! "+e)}return t},getConfigSwitch:function(e){return e=e||{},{onLabel:null==e.onLabel?void 0:e.onLabel,offLabel:null==e.offLabel?void 0:e.offLabel}},getConfigBarcode:function(e){var t={type:null==e.type?void 0:e.type,width:null==e.width?void 0:parseInt(e.width),height:null==e.height?void 0:parseInt(e.height)};return t.type||(t.type="EAN8"),t},getConfigQrcode:function(e){var t={errorCorrection:null==e.errorCorrection?void 0:e.errorCorrection,size:null==e.size?void 0:parseInt(e.size),color:null==e.color?void 0:e.color};return(e.borderColor||e.borderSize)&&(t.border={size:null==e.size?void 0:parseInt(e.size),color:null==e.color?void 0:e.color}),t}},window.showTreatedValue=function(e){return e||""},window.useMask=function(e,t,n){var a="";t="null"==t||"undefined"==t?void 0:t;var o=e,i=t||n;return null!=e&&void 0!=e&&(o=e instanceof Date?'"'+e.toISOString()+'"':"number"==typeof e?e:'"'+e+'"',a="{{ "+o+'  | mask:"'+i+'"}}'),a};